import"../chunks/CWj6FrbW.js";import{i as Me}from"../chunks/heriVLba.js";import{V as Ve,M as Z,ag as xt,ah as Ct,N as Et,K as Dt,a as t,b as Te,Q as Tt,T as Mt,U as Xe,W as He,$ as Ee,ai as St,aj as Lt,X as it,Y as dt,Z as At,ak as ct,al as ut,w as F,am as je,an as Pe,ao as Qe,ap as Ft,aq as It,ar as kt,as as Nt,at as Yt,au as Ot,av as Rt,aw as Ut,ax as Vt,a6 as vt,u as K,ay as ft,az as Ht,aA as Pt,a0 as qt,aB as Bt,aC as zt,aD as Gt,aE as Kt,aF as Wt,aG as $t,aH as Jt,a7 as Xt,aI as jt,a4 as Ae,j as Se,aJ as $e,k as Ne,s as p,H as We,m as Ye,n as N,y as E,x as C,z as w,t as W,aK as Qt,aL as Ze,A as ae,q as ee,r as L,v as Le,o as Oe,aM as Zt,B as _e,aN as gt,aO as er,aP as tr,J as rr}from"../chunks/s4GdUkTq.js";import{i as P,s as ar,a as qe}from"../chunks/Bf4ltAop.js";import{c as Fe,d as nr,e as sr,f as lr,g as pt,i as mt,u as or,h as et}from"../chunks/3xWfw-0N.js";import{p as pe}from"../chunks/BVK1Sycj.js";function ir(e,a,r,n){for(var o=[],u=a.length,l=0;l<u;l++)kt(a[l].e,o,!0);var s=u>0&&o.length===0&&r!==null;if(s){var i=r.parentNode;Nt(i),i.append(r),n.clear(),fe(e,a[0].prev,a[u-1].next)}Yt(o,()=>{for(var c=0;c<u;c++){var d=a[c];s||(n.delete(d.k),fe(e,d.prev,d.next)),Ot(d.e,!s)}})}function Ie(e,a,r,n,o,u=null){var l=e,s={flags:a,items:new Map,first:null};{var i=e;l=Z?Ve(xt(i)):i.appendChild(Ct())}Z&&Et();var c=null,d=!1,f=Te(()=>{var v=r();return ut(v)?v:v==null?[]:ct(v)});Dt(()=>{var v=t(f),g=v.length;if(d&&g===0)return;d=g===0;let b=!1;if(Z){var T=Tt(l)===Mt;T!==(g===0)&&(l=Xe(),Ve(l),He(!1),b=!0)}if(Z){for(var D=null,h,_=0;_<g;_++){if(Ee.nodeType===St&&Ee.data===Lt){l=Ee,b=!0,He(!1);break}var I=v[_],x=n(I,_);h=ht(Ee,s,D,null,I,x,_,o,a,r),s.items.set(x,h),D=h}g>0&&Ve(Xe())}Z||dr(v,s,l,o,a,n,r),u!==null&&(g===0?c?it(c):c=dt(()=>u(l)):c!==null&&At(c,()=>{c=null})),b&&He(!0),t(f)}),Z&&(l=Ee)}function dr(e,a,r,n,o,u,l){var s=e.length,i=a.items,c=a.first,d=c,f,v=null,g=[],b=[],T,D,h,_;for(_=0;_<s;_+=1){if(T=e[_],D=u(T,_),h=i.get(D),h===void 0){var I=d?d.e.nodes_start:r;v=ht(I,a,v,v===null?a.first:v.next,T,D,_,n,o,l),i.set(D,v),g=[],b=[],d=v.next;continue}if(cr(h,T,_),(h.e.f&Pe)!==0&&it(h.e),h!==d){if(f!==void 0&&f.has(h)){if(g.length<b.length){var x=b[0],S;v=x.prev;var O=g[0],R=g[g.length-1];for(S=0;S<g.length;S+=1)tt(g[S],x,r);for(S=0;S<b.length;S+=1)f.delete(b[S]);fe(a,O.prev,R.next),fe(a,v,O),fe(a,R,x),d=x,v=R,_-=1,g=[],b=[]}else f.delete(h),tt(h,d,r),fe(a,h.prev,h.next),fe(a,h,v===null?a.first:v.next),fe(a,v,h),v=h;continue}for(g=[],b=[];d!==null&&d.k!==D;)(d.e.f&Pe)===0&&(f??(f=new Set)).add(d),b.push(d),d=d.next;if(d===null)continue;h=d}g.push(h),v=h,d=h.next}if(d!==null||f!==void 0){for(var M=f===void 0?[]:ct(f);d!==null;)(d.e.f&Pe)===0&&M.push(d),d=d.next;var m=M.length;if(m>0){var U=s===0?r:null;ir(a,M,U,i)}}Qe.first=a.first&&a.first.e,Qe.last=v&&v.e}function cr(e,a,r,n){It(e.v,a),e.i=r}function ht(e,a,r,n,o,u,l,s,i,c){var d=(i&Rt)!==0,f=(i&Ut)===0,v=d?f?F(o,!1,!1):je(o):o,g=(i&Ft)===0?l:je(l),b={i:g,v,k:u,a:null,e:null,prev:r,next:n};try{return b.e=dt(()=>s(e,v,g,c),Z),b.e.prev=r&&r.e,b.e.next=n&&n.e,r===null?a.first=b:(r.next=b,r.e.next=b.e),n!==null&&(n.prev=b,n.e.prev=b.e),b}finally{}}function tt(e,a,r){for(var n=e.next?e.next.e.nodes_start:r,o=a?a.e.nodes_start:r,u=e.e.nodes_start;u!==n;){var l=Vt(u);o.before(u),u=l}}function fe(e,a,r){a===null?e.first=r:(a.next=r,a.e.next=r&&r.e),r!==null&&(r.prev=a,r.e.prev=a&&a.e)}function ur(e,a,r){vt(()=>{var n=K(()=>a(e,r==null?void 0:r())||{});if(n!=null&&n.destroy)return()=>n.destroy()})}const rt=[...` 	
\r\fÂ \v\uFEFF`];function vr(e,a,r){var n=e==null?"":""+e;if(r){for(var o in r)if(r[o])n=n?n+" "+o:o;else if(n.length)for(var u=o.length,l=0;(l=n.indexOf(o,l))>=0;){var s=l+u;(l===0||rt.includes(n[l-1]))&&(s===n.length||rt.includes(n[s]))?n=(l===0?"":n.substring(0,l))+n.substring(s+1):l=s}}return n===""?null:n}function at(e,a=!1){var r=a?" !important;":";",n="";for(var o in e){var u=e[o];u!=null&&u!==""&&(n+=" "+o+": "+u+r)}return n}function fr(e,a){if(a){var r="",n,o;return Array.isArray(a)?(n=a[0],o=a[1]):n=a,n&&(r+=at(n)),o&&(r+=at(o,!0)),r=r.trim(),r===""?null:r}return String(e)}function nt(e,a,r,n,o,u){var l=e.__className;if(Z||l!==r||l===void 0){var s=vr(r,n,u);(!Z||s!==e.getAttribute("class"))&&(s==null?e.removeAttribute("class"):e.className=s),e.__className=r}else if(u&&o!==u)for(var i in u){var c=!!u[i];(o==null||c!==!!o[i])&&e.classList.toggle(i,c)}return u}function Be(e,a={},r,n){for(var o in r){var u=r[o];a[o]!==u&&(r[o]==null?e.style.removeProperty(o):e.style.setProperty(o,u,n))}}function gr(e,a,r,n){var o=e.__style;if(Z||o!==a){var u=fr(a,n);(!Z||u!==e.getAttribute("style"))&&(u==null?e.removeAttribute("style"):e.style.cssText=u),e.__style=a}else n&&(Array.isArray(n)?(Be(e,r==null?void 0:r[0],n[0]),Be(e,r==null?void 0:r[1],n[1],"important")):Be(e,r,n));return n}function Je(e,a,r){if(e.multiple){if(a==null)return;if(!ut(a))return Ht();for(var n of e.options)n.selected=a.includes(De(n));return}for(n of e.options){var o=De(n);if(Pt(o,a)){n.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function bt(e){var a=new MutationObserver(()=>{Je(e,e.__value)});a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qt(()=>{a.disconnect()})}function pr(e,a,r=a){var n=!0;ft(e,"change",o=>{var u=o?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(u),De);else{var s=e.querySelector(u)??e.querySelector("option:not([disabled])");l=s&&De(s)}r(l)}),vt(()=>{var o=a();if(Je(e,o,n),n&&o===void 0){var u=e.querySelector(":checked");u!==null&&(o=De(u),r(o))}e.__value=o,n=!1}),bt(e)}function De(e){return"__value"in e?e.__value:e.value}const mr=Symbol("is custom element"),hr=Symbol("is html");function ye(e){if(Z){var a=!1,r=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var n=e.value;ke(e,"value",null),e.value=n}if(e.hasAttribute("checked")){var o=e.checked;ke(e,"checked",null),e.checked=o}}};e.__on_r=r,Bt(r),zt()}}function ke(e,a,r,n){var o=br(e);Z&&(o[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||o[a]!==(o[a]=r)&&(a==="loading"&&(e[Gt]=r),r==null?e.removeAttribute(a):typeof r!="string"&&yr(e).includes(a)?e[a]=r:e.setAttribute(a,r))}function br(e){return e.__attributes??(e.__attributes={[mr]:e.nodeName.includes("-"),[hr]:e.namespaceURI===Kt})}var st=new Map;function yr(e){var a=st.get(e.nodeName);if(a)return a;st.set(e.nodeName,a=[]);for(var r,n=e,o=Element.prototype;o!==n;){r=$t(n);for(var u in r)r[u].set&&a.push(u);n=Wt(n)}return a}function ge(e,a,r=a){var n=Jt();ft(e,"input",o=>{var u=o?e.defaultValue:e.value;if(u=ze(e)?Ge(u):u,r(u),n&&u!==(u=a())){var l=e.selectionStart,s=e.selectionEnd;e.value=u??"",s!==null&&(e.selectionStart=l,e.selectionEnd=Math.min(s,e.value.length))}}),(Z&&e.defaultValue!==e.value||K(a)==null&&e.value)&&r(ze(e)?Ge(e.value):e.value),Xt(()=>{var o=a();ze(e)&&o===Ge(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function ze(e){var a=e.type;return a==="number"||a==="range"}function Ge(e){return e===""?null:+e}function wr(e){return function(...a){var r=a[0];r.target===this&&(e==null||e.apply(this,a))}}function _r(e){return function(...a){var r=a[0];return r.preventDefault(),e==null?void 0:e.apply(this,a)}}const lt={events:[],calendars:[],isLoadingEvents:!1,isLoadingCalendars:!1,error:null,selectedCalendarId:null},Ke=e=>({id:e.id,calendarId:e.calendarId,title:e.title,description:e.description,startTime:new Date(Number(e.startTime/1000000n)),endTime:new Date(Number(e.endTime/1000000n)),color:e.color}),ot=e=>({id:e.id,owner:e.owner,name:e.name,color:e.color}),ie=(()=>{const e=jt(lt);let a=null,r=null;const n=async()=>{if(a)return a;const l=Ae(Fe);if(!l)return e.update(s=>({...s,error:"User not authenticated for calendar operations"})),null;try{return a=await nr(sr,lr,l),a}catch(s){return console.error("Failed to create calendar canister actor:",s),e.update(i=>({...i,error:"Failed to connect to calendar service"})),null}},o=async()=>{if(r)return r;const l=Ae(Fe);if(!l)return e.update(s=>({...s,error:"User not authenticated for user registry operations"})),null;try{return r=await pt(l),r}catch(s){return console.error("Failed to create user registry actor:",s),e.update(i=>({...i,error:"Failed to connect to user registry service"})),null}};Fe.subscribe(l=>{l?Ae(mt)&&u.fetchUserCalendars():(a=null,r=null,e.set(lt))});const u={subscribe:e.subscribe,set:e.set,update:e.update,fetchUserCalendars:async()=>{e.update(s=>({...s,isLoadingCalendars:!0,error:null}));const l=await o();if(!l){e.update(s=>({...s,isLoadingCalendars:!1,error:"User Registry actor not available"}));return}try{console.log("Fetching user calendars from UserRegistry...");const i=(await l.get_my_calendars()).map(ot);if(e.update(c=>({...c,calendars:i,isLoadingCalendars:!1})),console.log("User calendars fetched:",i),i.length>0){const c=Ae(e).selectedCalendarId,d=i.some(f=>f.id===c);(!c||!d)&&(console.log("Auto-selecting first calendar:",i[0].id),e.update(f=>({...f,selectedCalendarId:i[0].id})),u.fetchEvents(i[0].id,new Date(new Date().getFullYear(),new Date().getMonth(),1),new Date(new Date().getFullYear(),new Date().getMonth()+1,0)))}else e.update(c=>({...c,selectedCalendarId:null,events:[]}))}catch(s){console.error("Error fetching user calendars:",s),e.update(i=>({...i,error:s.message||"Failed to fetch user calendars",isLoadingCalendars:!1}))}},createNewUserCalendar:async(l,s)=>{e.update(c=>({...c,isLoadingCalendars:!0,error:null}));const i=await o();if(!i)return e.update(c=>({...c,isLoadingCalendars:!1,error:"User Registry actor not available"})),null;try{const c=await i.create_calendar(l,s),d=ot(c);return await u.fetchUserCalendars(),e.update(f=>({...f,selectedCalendarId:d.id})),u.fetchEvents(d.id,new Date(new Date().getFullYear(),new Date().getMonth(),1),new Date(new Date().getFullYear(),new Date().getMonth()+1,0)),d}catch(c){return console.error("Error creating new user calendar:",c),e.update(d=>({...d,error:c.message||"Failed to create new calendar",isLoadingCalendars:!1})),null}},setSelectedCalendar:l=>{e.update(d=>({...d,selectedCalendarId:l,events:[]}));const s=new Date,i=new Date(s.getFullYear(),s.getMonth(),1),c=new Date(s.getFullYear(),s.getMonth()+1,0);u.fetchEvents(l,i,c)},fetchEvents:async(l,s,i)=>{if(!l){e.update(d=>({...d,events:[],error:"No calendar selected to fetch events for."}));return}e.update(d=>({...d,isLoadingEvents:!0,error:null}));const c=await n();if(!c){e.update(d=>({...d,isLoadingEvents:!1,error:"Calendar Canister actor not available"}));return}try{const d=BigInt(s.getTime())*1000000n,f=BigInt(i.getTime())*1000000n;console.log(`Fetching events for calendar ${l} from ${s.toISOString()} to ${i.toISOString()}`);const g=(await c.get_events_for_range(l,d,f)).map(Ke);e.update(b=>({...b,events:g,isLoadingEvents:!1}))}catch(d){console.error("Error fetching events:",d),e.update(f=>({...f,error:d.message||"Failed to fetch events",isLoadingEvents:!1}))}},createEvent:async l=>{e.update(i=>({...i,isLoadingEvents:!0,error:null}));const s=await n();if(!s)return e.update(i=>({...i,isLoadingEvents:!1,error:"Calendar Canister actor not available"})),null;try{const i=l.calendarId,c=l.title,d=l.description,f=BigInt(l.startTime.getTime())*1000000n,v=BigInt(l.endTime.getTime())*1000000n,g=l.color;console.log("Creating event with params:",i,c,d,f,v,g);const b=await s.create_event(i,c,d,f,v,g),T=Ke(b);return e.update(D=>({...D,events:[...D.events,T].sort((h,_)=>h.startTime.getTime()-_.startTime.getTime()),isLoadingEvents:!1})),T}catch(i){return console.error("Error creating event:",i),e.update(c=>({...c,error:i.message||"Failed to create event",isLoadingEvents:!1})),null}},updateEvent:async(l,s)=>{e.update(c=>({...c,isLoadingEvents:!0,error:null}));const i=await n();if(!i)return e.update(c=>({...c,isLoadingEvents:!1,error:"Calendar Canister actor not available"})),null;try{const c=s.title!==void 0?[s.title]:[],d=s.description!==void 0?[s.description]:[],f=s.startTime!==void 0?[BigInt(s.startTime.getTime())*1000000n]:[],v=s.endTime!==void 0?[BigInt(s.endTime.getTime())*1000000n]:[],g=s.color!==void 0?[s.color]:[];console.log(`Updating event ${l} with data:`,s);const b=await i.update_event(l,c,d,f,v,g);if(b.length>0){const T=b[0],D=Ke(T);return e.update(h=>({...h,events:h.events.map(_=>_.id===l?D:_).sort((_,I)=>_.startTime.getTime()-I.startTime.getTime()),isLoadingEvents:!1})),D}else return e.update(T=>({...T,error:"Failed to update event (no event returned)",isLoadingEvents:!1})),null}catch(c){return console.error("Error updating event:",c),e.update(d=>({...d,error:c.message||"Failed to update event",isLoadingEvents:!1})),null}},deleteEvent:async l=>{e.update(i=>({...i,isLoadingEvents:!0,error:null}));const s=await n();if(!s)return e.update(i=>({...i,isLoadingEvents:!1,error:"Calendar Canister actor not available"})),!1;try{console.log(`Deleting event ${l}`);const i=await s.delete_event(l);return i?e.update(c=>({...c,events:c.events.filter(d=>d.id!==l),isLoadingEvents:!1})):e.update(c=>({...c,error:"Failed to delete event on backend (returned false)",isLoadingEvents:!1})),i}catch(i){return console.error("Error deleting event:",i),e.update(c=>({...c,error:i.message||"Failed to delete event",isLoadingEvents:!1})),!1}}};return u})();console.log("calendarStore.ts updated to use actual canister declarations and actor calls.");var xr=N("<option> </option>"),Cr=N('<header class="px-4 py-2 flex items-center bg-white shadow sticky top-0 z-50"><img src="/favicon.svg" alt="Calendar Icon" class="h-8 w-8 mr-2"/> <h1 class="mr-10 text-xl text-gray-500 font-bold hidden sm:block">Calendar</h1> <button class="border rounded py-2 px-4 mr-2 sm:mr-5 text-gray-600 hover:bg-gray-100 text-sm sm:text-base">Today</button> <button class="p-1 sm:px-1 text-gray-600 hover:text-gray-800" aria-label="Previous period"><span class="material-icons-outlined cursor-pointer text-gray-600 mx-1 sm:mx-2 svelte-pr5hhu">chevron_left</span></button> <button class="p-1 sm:px-1 text-gray-600 hover:text-gray-800" aria-label="Next period"><span class="material-icons-outlined cursor-pointer text-gray-600 mx-1 sm:mx-2 svelte-pr5hhu">chevron_right</span></button> <h2 class="ml-2 sm:ml-4 text-lg sm:text-xl text-gray-700 font-medium whitespace-nowrap overflow-hidden text-ellipsis" style="min-width: 120px; max-width: 300px;"> </h2> <button title="Create new event" class="ml-4 sm:ml-6 p-2 rounded-full hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"><span class="material-icons-outlined text-blue-600 svelte-pr5hhu">add</span></button> <div class="ml-auto flex items-center space-x-1 sm:space-x-2"><button class="p-1 rounded-full hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400 hidden md:inline-flex"><span class="material-icons-outlined text-gray-600 svelte-pr5hhu">search</span></button> <button class="p-1 rounded-full hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400 hidden md:inline-flex"><span class="material-icons-outlined text-gray-600 svelte-pr5hhu">help_outline</span></button> <button class="p-1 rounded-full hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-400 hidden md:inline-flex"><span class="material-icons-outlined text-gray-600 svelte-pr5hhu">settings</span></button> <div class="relative"><select aria-label="Select calendar view" class="appearance-none border rounded py-2 pl-3 pr-8 text-sm sm:text-base text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white svelte-pr5hhu"></select> <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-600"><span class="material-icons-outlined text-sm svelte-pr5hhu">arrow_drop_down</span></div></div> <button class="ml-1 sm:ml-3 p-1 rounded-full hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400 hidden sm:inline-flex"><span class="material-icons-outlined text-gray-600 svelte-pr5hhu">account_circle</span></button></div></header>');function Er(e,a){Se(a,!1);const r=F();let n=pe(a,"currentView",12,"month"),o=pe(a,"displayDate",24,()=>new Date);const u=$e(),l=[{label:"Day",value:"day"},{label:"Month",value:"month"},{label:"Year",value:"year"}];function s(x){const O=x.target.value;O!==n()&&u("setView",O)}function i(x){u("navigate",x)}function c(){u("openEventModal")}Ne(()=>(We(n()),We(o())),()=>{p(r,n()==="month"?o().toLocaleString("default",{month:"long",year:"numeric"}):n()==="day"?o().toLocaleDateString("default",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):n()==="year"?o().getFullYear().toString():o().toLocaleDateString())}),Ye(),Me();var d=Cr(),f=E(C(d),4),v=E(f,2),g=E(v,2),b=E(g,2),T=C(b,!0);w(b);var D=E(b,2),h=E(D,2),_=E(C(h),6),I=C(_);W(()=>{n(),Qt(()=>{})}),Ie(I,5,()=>l,x=>x.value,(x,S)=>{var O=xr(),R=C(O,!0);w(O);var M={};W(()=>{ae(R,(t(S),K(()=>t(S).label))),M!==(M=(t(S),K(()=>t(S).value)))&&(O.value=(O.__value=(t(S),K(()=>t(S).value)))??"")}),L(x,O)}),w(I),Ze(2),w(_),Ze(2),w(h),w(d),W(()=>ae(T,t(r))),ee("click",f,()=>i("today")),ee("click",v,()=>i("prev")),ee("click",g,()=>i("next")),ee("click",D,c),pr(I,n),ee("change",I,s),L(e,d),Le()}var Dr=N('<div class="event-item text-xs p-1 rounded truncate text-white svelte-48jz61"> </div>'),Tr=N('<div class="events-list space-y-1 overflow-y-auto flex-grow"></div>'),Mr=N('<div role="button" tabindex="0"><div> </div> <!></div>'),Sr=N('<div class="month-view bg-white"><div class="days-of-week grid grid-cols-7 text-center text-sm text-gray-600 font-medium border-b border-gray-200"><div>Sun</div> <div>Mon</div> <div>Tue</div> <div>Wed</div> <div>Thu</div> <div>Fri</div> <div>Sat</div></div> <div class="grid grid-cols-7 grid-rows-5 min-h-[calc(100vh-200px)]"></div></div>');function Lr(e,a){Se(a,!1);let r=pe(a,"displayDate",24,()=>new Date),n=pe(a,"events",24,()=>[]);pe(a,"selectedCalendarId",8,null);const o=$e();let u=F([]);function l(){r().toLocaleString("default",{month:"long"}),r().getFullYear();const f=r().getFullYear(),v=r().getMonth(),g=new Date(f,v,1),T=new Date(f,v+1,0).getDate(),D=g.getDay(),h=[],_=new Date,I=new Date(f,v,0),x=D;for(let M=0;M<x;M++){const m=new Date(I.getFullYear(),I.getMonth(),I.getDate()-M);h.unshift({date:m,isCurrentMonth:!1,isToday:!1})}for(let M=1;M<=T;M++){const m=new Date(f,v,M);h.push({date:m,isCurrentMonth:!0,isToday:m.getDate()===_.getDate()&&m.getMonth()===_.getMonth()&&m.getFullYear()===_.getFullYear()})}const S=h.length,R=(Math.ceil(S/7)*7<35?35:Math.ceil(S/7)*7)-S;for(let M=1;M<=R;M++){const m=new Date(f,v+1,M);h.push({date:m,isCurrentMonth:!1,isToday:!1})}p(u,h)}function s(f){return n().filter(v=>{const g=new Date(v.startTime);return g.getFullYear()===f.getFullYear()&&g.getMonth()===f.getMonth()&&g.getDate()===f.getDate()}).slice(0,3)}function i(f){f.isCurrentMonth&&o("openEventModalForDate",f.date)}Oe(()=>{l()}),Ne(()=>We(r()),()=>{r()&&l()}),Ye(),Me();var c=Sr(),d=E(C(c),2);Ie(d,5,()=>t(u),f=>f.date.toISOString(),(f,v)=>{var g=Mr();let b;var T=C(g);let D;var h=C(T,!0);w(T);var _=E(T,2);{var I=x=>{var S=Tr();Ie(S,5,()=>(t(v),K(()=>s(t(v).date))),O=>O.id,(O,R)=>{var M=Dr();let m;var U=C(M,!0);w(M),W(q=>{ke(M,"title",(t(R),K(()=>t(R).title))),m=gr(M,"",m,q),ae(U,(t(R),K(()=>t(R).title)))},[()=>({"background-color":(t(R),K(()=>t(R).color||"#3b82f6"))})],Te),L(O,M)}),w(S),L(x,S)};P(_,x=>{t(v),K(()=>t(v).isCurrentMonth)&&x(I)})}w(g),W((x,S,O,R)=>{b=nt(g,1,"day-cell border border-gray-200 p-2 flex flex-col relative hover:bg-gray-50 svelte-48jz61",null,b,x),ke(g,"aria-label",S),D=nt(T,1,"day-number text-xs sm:text-sm mb-1 svelte-48jz61",null,D,O),ae(h,R)},[()=>({"not-current-month":!t(v).isCurrentMonth,today:t(v).isToday&&t(v).isCurrentMonth}),()=>(t(v),K(()=>`Date ${t(v).date.toLocaleDateString()}`)),()=>({"text-gray-900":t(v).isCurrentMonth,"text-gray-400":!t(v).isCurrentMonth,"font-bold":t(v).isToday&&t(v).isCurrentMonth}),()=>(t(v),K(()=>t(v).date.getDate()))],Te),ee("click",g,()=>i(t(v))),ee("keydown",g,x=>{(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),i(t(v)))}),L(f,g)}),w(d),w(c),L(e,c),Le()}var Ar=N('<p class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4 text-sm"> </p>'),Fr=N('<div class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[1000]" role="dialog" aria-modal="true" aria-labelledby="event-modal-title"><div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto"><h2 id="event-modal-title" class="text-xl font-semibold mb-4"> </h2> <!> <form><div class="mb-4"><label for="event-title" class="block text-sm font-medium text-gray-700 mb-1">Title</label> <input type="text" id="event-title" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"/></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label for="event-start-time" class="block text-sm font-medium text-gray-700 mb-1">Start Time</label> <input type="datetime-local" id="event-start-time" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"/></div> <div><label for="event-end-time" class="block text-sm font-medium text-gray-700 mb-1">End Time</label> <input type="datetime-local" id="event-end-time" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"/></div></div> <div class="mb-4"><label for="event-description" class="block text-sm font-medium text-gray-700 mb-1">Description (Optional)</label> <textarea id="event-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea></div> <div class="mb-6"><label for="event-color" class="block text-sm font-medium text-gray-700 mb-1">Color</label> <input type="color" id="event-color" class="w-full h-10 px-1 py-1 border border-gray-300 rounded-md shadow-sm"/></div> <div class="flex justify-end space-x-3"><button type="button" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel</button> <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"><!></button></div></form></div></div>');function Ir(e,a){Se(a,!1);let r=pe(a,"targetDate",8,null),n=pe(a,"eventToEdit",8,null),o=pe(a,"calendarId",8);const u=$e();let l=F(""),s=F(""),i=F(""),c=F(""),d=F("#3b82f6"),f=F(!1),v=F("");function g(y){const k=y.getFullYear(),z=(y.getMonth()+1).toString().padStart(2,"0"),me=y.getDate().toString().padStart(2,"0"),ue=y.getHours().toString().padStart(2,"0"),ce=y.getMinutes().toString().padStart(2,"0");return`${k}-${z}-${me}T${ue}:${ce}`}Oe(()=>{if(n())p(l,n().title),p(s,n().description),p(i,g(new Date(n().startTime))),p(c,g(new Date(n().endTime))),p(d,n().color||"#3b82f6");else if(r()){const y=new Date(r());y.setHours(9,0,0,0),p(i,g(y));const k=new Date(y);k.setHours(y.getHours()+1),p(c,g(k))}else{const y=new Date;y.setHours(y.getHours()+1,0,0,0),p(i,g(y));const k=new Date(y);k.setHours(y.getHours()+1),p(c,g(k))}});async function b(){if(!t(l).trim()){p(v,"Title is required.");return}if(!t(i)||!t(c)){p(v,"Start and end times are required.");return}const y=new Date(t(i)),k=new Date(t(c));if(y>=k){p(v,"End time must be after start time.");return}p(f,!0),p(v,"");try{const z={calendarId:o(),title:t(l),description:t(s),startTime:y,endTime:k,color:t(d)};if(n()&&n().id){const{calendarId:me,...ue}=z;await ie.updateEvent(n().id,ue)}else await ie.createEvent(z);u("eventSaved"),T()}catch(z){console.error("Failed to save event:",z),p(v,z.message||"Failed to save event. Please try again.")}finally{p(f,!1)}}function T(){u("close")}function D(y){const k=y.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),z=k[0],me=k[k.length-1];function ue(ce){ce.key==="Tab"?ce.shiftKey?document.activeElement===z&&(me.focus(),ce.preventDefault()):document.activeElement===me&&(z.focus(),ce.preventDefault()):ce.key==="Escape"&&T()}return z==null||z.focus(),y.addEventListener("keydown",ue),{destroy(){y.removeEventListener("keydown",ue)}}}Me();var h=Fr(),_=C(h),I=C(_),x=C(I,!0);w(I);var S=E(I,2);{var O=y=>{var k=Ar(),z=C(k,!0);w(k),W(()=>ae(z,t(v))),L(y,k)};P(S,y=>{t(v)&&y(O)})}var R=E(S,2),M=C(R),m=E(C(M),2);ye(m),w(M);var U=E(M,2),q=C(U),A=E(C(q),2);ye(A),w(q);var Y=E(q,2),$=E(C(Y),2);ye($),w(Y),w(U);var de=E(U,2),B=E(C(de),2);Zt(B),w(de);var J=E(de,2),se=E(C(J),2);ye(se),w(J);var le=E(J,2),X=C(le),V=E(X,2),ne=C(V);{var xe=y=>{var k=_e("Saving...");L(y,k)},Re=y=>{var k=_e();W(()=>ae(k,n()?"Save Changes":"Add Event")),L(y,k)};P(ne,y=>{t(f)?y(xe):y(Re,!1)})}w(V),w(le),w(R),w(_),ur(_,y=>D==null?void 0:D(y)),w(h),W(()=>{ae(x,n()?"Edit Event":"Add New Event"),V.disabled=t(f)}),ge(m,()=>t(l),y=>p(l,y)),ge(A,()=>t(i),y=>p(i,y)),ge($,()=>t(c),y=>p(c,y)),ge(B,()=>t(s),y=>p(s,y)),ge(se,()=>t(d),y=>p(d,y)),ee("click",X,T),ee("submit",R,_r(b)),ee("click",h,wr(T)),L(e,h),Le()}var kr=N('<div class="text-center p-10">Loading events...</div>'),Nr=N('<p class="text-center p-10">Day View (Coming Soon)</p>'),Yr=N('<p class="text-center p-10">Year View (Coming Soon)</p>'),Or=N('<div class="calendar-container flex flex-col h-full bg-gray-50 svelte-t4e59n"><!> <div class="calendar-body flex-grow overflow-auto p-4"><!> <!></div> <!></div>');function Rr(e,a){Se(a,!1);let r=F("month"),n=F(new Date),o=F(!1),u=F(null),l=F([]),s=F(null),i=F(!1);const c=ie.subscribe(m=>{p(l,m.events),p(s,m.selectedCalendarId),p(i,m.isLoadingEvents)});function d(m){p(r,m.detail),b()}function f(m){const U=m.detail;let q=new Date(t(n));if(U==="today")q=new Date;else{const A=U==="next"?1:-1;t(r)==="month"?q.setMonth(q.getMonth()+A):t(r)==="day"?q.setDate(q.getDate()+A):t(r)==="year"&&q.setFullYear(q.getFullYear()+A)}p(n,q)}function v(m){p(u,(m==null?void 0:m.detail)||new Date),p(o,!0)}function g(){p(o,!1),p(u,null)}async function b(){if(!t(s)){ie.update(q=>({...q,events:[]}));return}let m,U;if(t(r)==="month")m=new Date(t(n).getFullYear(),t(n).getMonth(),1),U=new Date(t(n).getFullYear(),t(n).getMonth()+1,0,23,59,59,999);else if(t(r)==="day")m=new Date(t(n).getFullYear(),t(n).getMonth(),t(n).getDate()),U=new Date(t(n).getFullYear(),t(n).getMonth(),t(n).getDate(),23,59,59,999);else if(t(r)==="year")m=new Date(t(n).getFullYear(),0,1),U=new Date(t(n).getFullYear(),11,31,23,59,59,999);else{console.error("Unknown view for fetching events:",t(r));return}await ie.fetchEvents(t(s),m,U)}Oe(()=>{t(s)&&b()}),gt(()=>{c&&c()}),Ne(()=>(t(n),t(r),t(s)),()=>{(t(n)||t(r)||t(s))&&b()}),Ye(),Me();var T=Or(),D=C(T);Er(D,{get currentView(){return t(r)},set currentView(m){p(r,m)},get displayDate(){return t(n)},set displayDate(m){p(n,m)},$$events:{setView:d,navigate:f,openEventModal:v},$$legacy:!0});var h=E(D,2),_=C(h);{var I=m=>{var U=kr();L(m,U)};P(_,m=>{t(i)&&m(I)})}var x=E(_,2);{var S=m=>{Lr(m,{get events(){return t(l)},get selectedCalendarId(){return t(s)},get displayDate(){return t(n)},set displayDate(U){p(n,U)},$$events:{openEventModalForDate:v},$$legacy:!0})},O=(m,U)=>{{var q=Y=>{var $=Nr();L(Y,$)},A=(Y,$)=>{{var de=B=>{var J=Yr();L(B,J)};P(Y,B=>{t(r)==="year"&&B(de)},$)}};P(m,Y=>{t(r)==="day"?Y(q):Y(A,!1)},U)}};P(x,m=>{t(r)==="month"?m(S):m(O,!1)})}w(h);var R=E(h,2);{var M=m=>{Ir(m,{get targetDate(){return t(u)},get calendarId(){return t(s)},$$events:{close:g,eventSaved:()=>{b(),g()}}})};P(R,m=>{t(o)&&t(s)&&m(M)})}w(T),L(e,T),Le()}var Ur=N('<meta name="description" content="A simple calendar application"/>'),Vr=N('<p class="text-red-500 text-sm mb-4"> </p>'),Hr=N('<div class="registration-form bg-white p-8 rounded-lg shadow-md max-w-md mx-auto my-10"><h2 class="text-xl font-semibold text-center mb-6">Welcome! Please Register</h2> <!> <input type="text" placeholder="Your Name" class="w-full px-3 py-2 border rounded mb-4"/> <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded disabled:opacity-75"><!></button></div>'),Pr=N('<p class="text-sm text-gray-500">Loading calendars...</p>'),qr=N("<option> </option>"),Br=N('<select id="calendar-select" class="w-full sm:min-w-[200px] mt-1 block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>'),zr=N('<p class="text-sm text-gray-500">No calendars found. Please create one.</p>'),Gr=N('<p class="text-red-500 text-xs mt-1"> </p>'),Kr=N('<p class="text-red-500 text-sm mb-2"> </p>'),Wr=N('<div class="new-calendar-form mt-4 pt-4 border-t"><h3 class="text-md font-semibold mb-2">Create New Calendar</h3> <!> <input type="text" placeholder="Calendar Name" class="w-full px-3 py-2 border rounded mb-2"/> <div class="flex items-center mb-3"><label for="new-calendar-color" class="mr-2 text-sm">Color:</label> <input type="color" id="new-calendar-color" class="h-8 w-12 border rounded"/></div> <button class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded text-sm disabled:opacity-75"><!></button></div>'),$r=N('<p class="text-center text-gray-600">Please select a calendar to view.</p>'),Jr=N('<div class="calendar-management mb-6 p-4 bg-white rounded-lg shadow"><div class="flex flex-col sm:flex-row items-center justify-between gap-4"><div class="flex-grow w-full sm:w-auto"><label for="calendar-select" class="block text-sm font-medium text-gray-700 mb-1">Select Calendar:</label> <!> <!></div> <button class="w-full sm:w-auto mt-2 sm:mt-0 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"> </button></div> <!></div> <!>',1),Xr=N('<p class="text-center text-gray-500 mt-10">Please log in to manage and view your calendars.</p>'),jr=N('<p class="text-center text-gray-500 mt-10">Loading user information...</p>'),Qr=N('<div class="container mx-auto p-4 min-h-screen svelte-gsiio6"><!></div>');function sa(e,a){Se(a,!1);const[r,n]=ar(),o=()=>qe(mt,"$isLoggedIn",r),u=()=>qe(or,"$userProfile",r),l=()=>qe(Fe,"$authIdentity",r);let s=F(!1),i=F(""),c=F(!1),d=F(""),f=F([]),v=F(null),g=F(!1),b=F(null);const T=ie.subscribe(A=>{p(f,A.calendars),p(v,A.selectedCalendarId),p(g,A.isLoadingCalendars),p(b,A.error)});let D=F(!1),h=F(""),_=F("#4285F4"),I=F(!1),x=F("");const S=async()=>{var A;if(!t(i).trim()){p(d,"Please enter your name.");return}p(c,!0),p(d,"");try{const Y=l();if(!Y)throw new Error("Identity not available.");await(await pt(Y)).register(t(i)),await et(),p(s,!1),o()&&u()&&ie.fetchUserCalendars()}catch(Y){console.error("Registration failed:",Y),p(d,(A=Y.message)!=null&&A.includes("User already registered")?"Already registered. Refreshing...":"Registration failed."),t(d).includes("Refreshing")&&await et()}finally{p(c,!1)}};function O(A){const Y=A.target,$=BigInt(Y.value);$&&ie.setSelectedCalendar($)}async function R(){if(!t(h).trim()){p(x,"Calendar name is required.");return}p(I,!0),p(x,"");try{await ie.createNewUserCalendar(t(h),t(_))?(p(D,!1),p(h,"")):p(x,t(b)||"Failed to create calendar.")}catch(A){console.error("Failed to create new calendar:",A),p(x,A.message||"An unexpected error occurred.")}finally{p(I,!1)}}Oe(async()=>{o()&&u()&&t(f).length===0&&!t(g)&&await ie.fetchUserCalendars()}),gt(()=>{T&&T()}),Ne(()=>(o(),u(),l()),()=>{o()&&u()===null&&!l().getPrincipal().isAnonymous()?p(s,!0):p(s,!1)}),Ye(),Me();var M=Qr();er(A=>{var Y=Ur();tr.title="ICP Calendar",L(A,Y)});var m=C(M);{var U=A=>{var Y=Hr(),$=E(C(Y),2);{var de=V=>{var ne=Vr(),xe=C(ne,!0);w(ne),W(()=>ae(xe,t(d))),L(V,ne)};P($,V=>{t(d)&&V(de)})}var B=E($,2);ye(B);var J=E(B,2),se=C(J);{var le=V=>{var ne=_e("Registering...");L(V,ne)},X=V=>{var ne=_e("Register");L(V,ne)};P(se,V=>{t(c)?V(le):V(X,!1)})}w(J),w(Y),W(()=>{B.disabled=t(c),J.disabled=t(c)}),ge(B,()=>t(i),V=>p(i,V)),ee("click",J,S),L(A,Y)},q=(A,Y)=>{{var $=B=>{var J=Jr(),se=rr(J),le=C(se),X=C(le),V=E(C(X),2);{var ne=H=>{var te=Pr();L(H,te)},xe=(H,te)=>{{var ve=re=>{var Q=Br();Ie(Q,5,()=>t(f),j=>j.id,(j,we)=>{var be=qr(),Ue=C(be,!0);w(be);var G={};W(oe=>{ae(Ue,(t(we),K(()=>t(we).name))),G!==(G=oe)&&(be.value=(be.__value=oe)??"")},[()=>(t(we),K(()=>t(we).id.toString()))],Te),L(j,be)}),w(Q);var Ce;bt(Q),W(j=>{Ce!==(Ce=j)&&(Q.value=(Q.__value=j)??"",Je(Q,j))},[()=>(t(v),K(()=>{var j;return((j=t(v))==null?void 0:j.toString())||""}))],Te),ee("change",Q,O),L(re,Q)},he=re=>{var Q=zr();L(re,Q)};P(H,re=>{t(f),K(()=>t(f).length>0)?re(ve):re(he,!1)},te)}};P(V,H=>{t(g)?H(ne):H(xe,!1)})}var Re=E(V,2);{var y=H=>{var te=Gr(),ve=C(te,!0);w(te),W(()=>ae(ve,t(b))),L(H,te)};P(Re,H=>{t(b)&&H(y)})}w(X);var k=E(X,2),z=C(k,!0);w(k),w(le);var me=E(le,2);{var ue=H=>{var te=Wr(),ve=E(C(te),2);{var he=G=>{var oe=Kr(),_t=C(oe,!0);w(oe),W(()=>ae(_t,t(x))),L(G,oe)};P(ve,G=>{t(x)&&G(he)})}var re=E(ve,2);ye(re);var Q=E(re,2),Ce=E(C(Q),2);ye(Ce),w(Q);var j=E(Q,2),we=C(j);{var be=G=>{var oe=_e("Creating...");L(G,oe)},Ue=G=>{var oe=_e("Create Calendar");L(G,oe)};P(we,G=>{t(I)?G(be):G(Ue,!1)})}w(j),w(te),W(()=>j.disabled=t(I)),ge(re,()=>t(h),G=>p(h,G)),ge(Ce,()=>t(_),G=>p(_,G)),ee("click",j,R),L(H,te)};P(me,H=>{t(D)&&H(ue)})}w(se);var ce=E(se,2);{var yt=H=>{Rr(H,{})},wt=(H,te)=>{{var ve=he=>{var re=$r();L(he,re)};P(H,he=>{t(g),t(f),K(()=>!t(g)&&t(f).length>0)&&he(ve)},te)}};P(ce,H=>{t(v)?H(yt):H(wt,!1)})}W(()=>ae(z,t(D)?"Cancel":"+ New Calendar")),ee("click",k,()=>p(D,!t(D))),L(B,J)},de=(B,J)=>{{var se=X=>{var V=Xr();L(X,V)},le=X=>{var V=jr();L(X,V)};P(B,X=>{o()?X(le,!1):X(se)},J)}};P(A,B=>{o()&&u()?B($):B(de,!1)},Y)}};P(m,A=>{t(s)?A(U):A(q,!1)})}w(M),L(e,M),Le(),n()}export{sa as component};
